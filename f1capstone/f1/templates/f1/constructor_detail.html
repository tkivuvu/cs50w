{% extends 'layout.html' %}
{% load static %}
{% block title %}Team • {{ constructor_id|title }} • {{ year }} • F1 Capstone{% endblock %}

{% block content %}
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 mb-0">{{ constructor_id|title }}</h1>
    <div>
      {% if user.is_authenticated %}
        <form method="post" action="{% url 'f1:favorite_constructor_toggle' constructor_id %}">
          {% csrf_token %}
          <button class="btn btn-sm {% if is_favorite %}btn-warning text-dark{% else %}btn-outline-light{% endif %}"
                  type="submit"
                  aria-label="{% if is_favorite %}Remove from favorites{% else %}Add to favorites{% endif %}">
            {% if is_favorite %}★ Favorited{% else %}☆ Add to Favorites{% endif %}
          </button>
        </form>
      {% else %}
        <a class="btn btn-sm btn-outline-light" href="{% url 'login' %}?next={{ request.path|urlencode }}">
          ☆ Log in to favorite
        </a>
      {% endif %}
    </div>
  </div>

  <div class="row g-4 mb-4">
    {% for d in driver_cards %}
      <div class="col-12 col-md-6">
        <div class="card bg-black border-secondary h-100">
          <div class="card-body d-flex gap-3 align-items-center">
            <img
              src="{% static 'f1/img/drivers/full/' %}{{ d.img }}"
              alt="{{ d.name }}"
              width="140" height="140"
              style="object-fit:cover;object-position:top center;border:1px solid var(--bs-secondary);border-radius:16px;"
              onerror="this.style.display='none'">

            <div class="flex-grow-1">
              <div class="d-flex align-items-center gap-2 mb-1">
                <img src="{% static 'f1/img/flags/' %}{{ d.nationality }}.png"
                     alt="{{ d.nationality }}" width="20" height="14"
                     style="object-fit:cover;border:1px solid var(--bs-secondary);border-radius:2px;"
                     onerror="this.style.display='none'">
                <h2 class="h5 mb-0">{{ d.name }}</h2>
              </div>
              <div class="text-secondary small">
                Car No: <span class="text-light">{{ d.number }}</span>
              </div>

              <div class="mt-2">
                <a href="{% url 'f1:driver_detail' d.driverId %}" class="btn btn-sm btn-outline-light">
                  View Driver
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12"><div class="text-secondary">No drivers found for this team.</div></div>
    {% endfor %}
  </div>

  <div class="mb-4 text-center">
    <img
      src="{% static 'f1/img/constructors/full/' %}{{ livery_img }}"
      alt="{{ constructor_id }} livery"
      style="max-width:100%;height:auto;border:1px solid var(--bs-secondary);border-radius:16px;"
      onerror="this.style.display='none'">
  </div>

  <div class="row g-4 mb-4">
    <div class="col-12 col-md-6">
      <div class="card bg-black border-secondary">
        <div class="card-body">
          <h3 class="h6 text-secondary mb-2">Season Position</h3>
          <div class="display-6 mb-0">{{ season_pos|default:"—" }}</div>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-6">
      <div class="card bg-black border-secondary">
        <div class="card-body">
          <h3 class="h6 text-secondary mb-2">Season Points</h3>
          <div class="display-6 mb-0">{{ season_pts|default:"0" }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mb-4">
    <div class="col-12">
      <div class="card bg-black border-secondary">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between">
            <h3 class="h5 mb-0">Grand Prix Stats ({{ year }})</h3>
            <small class="text-secondary">* DNFs = mechanical/retirements only</small>
          </div>
          <div class="row row-cols-2 row-cols-md-4 g-3 text-center mt-2">
            <div><div class="text-secondary small">GPs Entered</div><div class="fs-4">{{ gp_entered }}</div></div>
            <div><div class="text-secondary small">GP Points</div><div class="fs-4">{{ gp_points|floatformat:0 }}</div></div>
            <div><div class="text-secondary small">GP Wins</div><div class="fs-4">{{ gp_wins }}</div></div>
            <div><div class="text-secondary small">GP Podiums</div><div class="fs-4">{{ gp_podiums }}</div></div>
            <div><div class="text-secondary small">GP Poles</div><div class="fs-4">{{ gp_poles }}</div></div>
            <div><div class="text-secondary small">GP Top 10s</div><div class="fs-4">{{ gp_top10 }}</div></div>
            <div><div class="text-secondary small">DNFs (Mechanical)</div><div class="fs-4">{{ gp_dnfs }}</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-12">
      <div class="card bg-black border-secondary">
        <div class="card-body">
          <h3 class="h5 mb-3">Sprint Stats ({{ year }})</h3>
          <div class="row row-cols-2 row-cols-md-4 g-3 text-center">
            <div><div class="text-secondary small">Sprints Entered</div><div class="fs-4">{{ sp_entered }}</div></div>
            <div><div class="text-secondary small">Sprint Points</div><div class="fs-4">{{ sp_points|floatformat:0 }}</div></div>
            <div><div class="text-secondary small">Sprint Wins</div><div class="fs-4">{{ sp_wins }}</div></div>
            <div><div class="text-secondary small">Sprint Podiums</div><div class="fs-4">{{ sp_podiums }}</div></div>
            <div><div class="text-secondary small">Sprint Top 8s</div><div class="fs-4">{{ sp_top8 }}</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
